---
title: ä½¿ç”¨EChartsåœ°å›¾æ—¶ä½ åº”è¯¥äº†è§£çš„çŸ¥è¯†
date: 2023-02-23
outline: deep
tags:
  - å‰ç«¯
  - ECharts
  - GeoJSON
---

# ä½¿ç”¨EChartsåœ°å›¾æ—¶ä½ åº”è¯¥äº†è§£çš„çŸ¥è¯†

æœ¬ç¯‡æ–‡ç« æ˜¯ç§‘æ™®å‘ï¼Œéå®æˆ˜æŒ‡å—ï¼Œè¯¦ç»†çš„ä½¿ç”¨è¯·å¯¹ç…§å®˜ç½‘é…ç½®é¡¹æ‰‹å†Œï¼š[geo](https://echarts.apache.org/zh/option.html#geo)ã€[series-map](https://echarts.apache.org/zh/option.html#series-map)ã€‚

---

2018å¹´3æœˆï¼Œç™¾åº¦å°†EChartsé¡¹ç›®æèµ ç»™ApacheåŸºé‡‘ä¼šï¼ŒEChartsæˆä¸ºäº†ApacheåŸºé‡‘ä¼šå­µåŒ–çº§é¡¹ç›®ï¼ŒåŒæ—¶ä¹Ÿæ˜¯é¦–ä¸ªç”±ç™¾åº¦è´¡çŒ®ç»™å›½é™…é¡¶çº§åŸºé‡‘ä¼šçš„å¼€æºé¡¹ç›®ã€‚


2021å¹´1æœˆ26æ—¥æ™šï¼ŒApacheåŸºé‡‘ä¼šæ­£å¼å®˜å®£[Apache ECharts](https://echarts.apache.org/zh/index.html)é¡ºåˆ©é€šè¿‡å­µåŒ–é˜¶æ®µï¼Œæ™‹å‡ä¸ºApacheé¡¶çº§é¡¹ç›®ã€‚

åˆ°äº†2023å¹´çš„ä»Šå¤©ï¼ŒEChartsçš„ç¬¬äº”ä¸ªå¤§ç‰ˆæœ¬äº†å·²ç»å‘å¸ƒä¸¤å¹´äº†ã€‚ä»v4åˆ°v5ï¼ŒEChartsæœ‰äº†å¾ˆå¤šçš„[æ–°ç‰¹æ€§](https://echarts.apache.org/handbook/zh/basics/release-note/v5-feature/)ï¼Œæœ¬ç¯‡ä¸»è¦ä»‹ç»åœ°å›¾ç›¸å…³çš„ä½¿ç”¨ã€‚


ç»“åˆ[å‡çº§æŒ‡å—](https://echarts.apache.org/handbook/zh/basics/release-note/v5-upgrade-guide/)ï¼Œv5ç‰ˆæœ¬æœ‰ä»¥ä¸‹çš„å˜åŠ¨ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼š

- v5ç§»é™¤äº†å†…ç½®çš„GeoJSON
- actionåå˜æ›´
  - `mapToggleSelect` â¡ï¸ `toggleSelect`
  - `mapSelect` â¡ï¸ `select`
  - `mapUnSelect` â¡ï¸ `unselect`
- äº‹ä»¶åå˜æ›´
  - `mapselectchanged` â¡ï¸ `selectchanged`
  - `mapselected` â¡ï¸ `selected`
  - `mapunselected` â¡ï¸ `unselected`
- é€‰é¡¹`series.mapType`å·²ç»ä¸æ¨èä½¿ç”¨ã€‚ä½¿ç”¨`series.map`ä»£æ›¿ã€‚
- é€‰é¡¹`series.mapLocation`å·²ç»ä¸æ¨èä½¿ç”¨ã€‚

## 01. åœ°å›¾çš„åŸºçŸ³â€”â€”GeoJSON

[GeoJSON](https://geojson.org/)æ˜¯ç”¨äºæè¿°å„ç§åœ°ç†åŒºåŸŸæ•°æ®çš„ä¸€ç§æ ¼å¼ã€‚å®ƒæ˜¯ä¸€ç§å›½é™…é€šç”¨çš„è§„èŒƒï¼Œ[ã€ŠGeoJSONè§„èŒƒã€‹](https://tools.ietf.org/html/rfc7946)å‘å¸ƒäº2016å¹´ã€‚


ç”¨JavaScriptçš„æ¦‚å¿µæ¥è®²ï¼ŒGeoJSONå°±æ˜¯ä¸€ä¸ªJSONå¯¹è±¡ï¼Œå®ƒå¯ä»¥é€šè¿‡ç¬¦åˆè§„èŒƒçš„é”®å€¼å¯¹æ¥æè¿°åœ°ç†ä¿¡æ¯ã€‚


ä¸€ä¸ªæœ‰æ•ˆçš„GeoJSONå¤§æ¦‚é•¿è¿™æ ·ï¼š

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "coordinates": [
          116.43063202970814,
          39.96344762877294
        ],
        "type": "Point"
      }
    },
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "coordinates": [
          [
            116.46519108511751,
            39.88763321805527
          ],
          [
            121.48769570803233,
            31.26687775248952
          ]
        ],
        "type": "LineString"
      }
    },
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "coordinates": [
          [
            [
              112.85356201413333,
              43.37087847681994
            ],
            [
              112.85356201413333,
              37.914976897592496
            ],
            [
              119.75011160256912,
              37.914976897592496
            ],
            [
              119.75011160256912,
              43.37087847681994
            ],
            [
              112.85356201413333,
              43.37087847681994
            ]
          ]
        ],
        "type": "Polygon"
      }
    }
  ]
}
```


æˆ‘ä»¬å¯ä»¥åœ¨[GeoJSON.io](https://geojson.io/)ä¸­æŸ¥çœ‹æ•ˆæœï¼Œåœ°å›¾ä¸Šæ·±ç°è‰²çš„éƒ¨åˆ†å°±æ˜¯ä¸Šé¢çš„GeoJSONç¤ºä¾‹æ‰€è¡¨è¾¾çš„ä¿¡æ¯ï¼Œå®ƒåŒ…å«ä¸€ä¸ªç‚¹`Point`ã€ä¸€ä¸ªé¢`Polygon`å’Œä¸€æ¡çº¿`LineString`ï¼š

![img](./20230223-echarts-map.assets/1677052168415-1bde6b3e-2b7e-4da2-b9ce-236c100a365b.png)


GeoJSONè§„å®šï¼Œä¸€ä¸ª`GeoJSON Object`ä¸­å¿…ç„¶æœ‰`type`å±æ€§ï¼Œå®ƒæœ‰å›ºå®šçš„å‡ ä¸ªå–å€¼ï¼š`Feature`ã€`FeatureCollection`å’Œå…¶ä»–`geometry typeï¼ˆå‡ ä½•ç±»å‹ï¼‰`ï¼š

![img](./20230223-echarts-map.assets/1677053473146-32695766-b08c-43ab-a645-210afb04ce9e.jpeg)


ä¸åŒçš„`type`å–å€¼ï¼Œæ‰€éœ€çš„å¿…è¦æˆå‘˜ä¹Ÿä¸åŒï¼š

- å–å€¼`FeatureCollection`æ—¶ï¼Œå¿…é¡»æœ‰æˆå‘˜ï¼š`features`
- å–å€¼`Feature`æ—¶ï¼Œå¿…é¡»æœ‰æˆå‘˜ï¼š`geometry`
- å–å€¼å‡ ä½•ç±»å‹æ—¶ï¼Œå¿…é¡»æœ‰æˆå‘˜ï¼š`coordinates`


ä»ä¸Šé¢ç¤ºä¾‹çš„GeoJSONä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸åŒç±»å‹çš„å±‚çº§ç»“æ„å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š`FeatureCollection`->`Feature`->`geometry type`ã€‚


GeoJSONé™¤äº†å¿…è¦çš„æˆå‘˜å¤–ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰æˆå‘˜æˆ–è€…åœ¨`properties`ä¸­æ·»åŠ è‡ªå®šä¹‰å±æ€§ï¼Œä»¥é…åˆæ‰€ä½¿ç”¨çš„è§£æGeoJSONçš„å·¥å…·ã€‚æ¯”å¦‚EChartsä¼šé»˜è®¤è¯»å–`Feature`å¯¹è±¡ä¸‹çš„`properties.name`ä½œä¸ºåœ°åŸŸçš„ä¸­æ–‡åã€‚


å½“ç„¶æŠŠè‡ªå®šä¹‰å±æ€§æ”¾åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥ï¼Œåªè¦å¿…é¡»çš„å±æ€§åœ¨å°±è¡Œã€‚æ¯”å¦‚EChartsçš„GeoJSONï¼Œåœ¨ä¸`type`åŒçº§æ”¾äº†ä¸ª`id`ã€‚

```json{6}
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "id": "710000",
      "properties": {
        "id": "710000",
        "cp": [
          121.509062,
          24.044332
        ],
        "name": "å°æ¹¾",
        "childNum": 6
      }
    }
  ]
}
```


GeoJSONä¸å…‰å¯ä»¥åº”ç”¨åœ¨EChartsç»˜åˆ¶åœ°å›¾ï¼Œè¿˜å¯ä»¥åœ¨å„ç§åœ°å›¾æ’ä»¶ä¸­ä½¿ç”¨ï¼Œæ¯”å¦‚é«˜å¾·åœ°å›¾ä¸­ï¼Œå¯ä»¥é€šè¿‡`Loca.GeoJSONSource`åŠ è½½è‡ªå®šä¹‰GeoJSONæ•°æ®æºã€‚

## 02. ä¸­å›½åœ°å›¾GeoJSON

### 2.1 ä¸‹è½½ä¸­å›½åœ°å›¾çš„GeoJSON

[å‰è¨€](https://www.yuque.com/wangxiaocuo/coding-blog/wagzirug6pv02bcv#tK8vp)ä¸­æåˆ°ï¼ŒECharts v5å·²ç»ç§»é™¤äº†å†…ç½®çš„GeoJSONï¼Œæ‰€ä»¥ECharts v5å·²ç»ä¸èƒ½å¼€ç®±å³ç”¨åœ°æ˜¾ç¤ºä¸­å›½åœ°å›¾äº†ã€‚


æˆ‘æ¨èä¸‰ç§æ–¹å¼ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ‰¾åˆ°ä¸­å›½åœ°å›¾ç›¸å…³çš„GeoJSONï¼š


æ–¹å¼ä¸€ï¼šä¸‹è½½[ECharts v4.x](https://github.com/apache/echarts/releases/tag/4.9.0)æºç ï¼Œåœ¨`map/json/`ä¸‹å¯ä»¥æ‰¾åˆ°

![img](./20230223-echarts-map.assets/1677058890325-e8dc6545-0aad-46c3-8b9d-ef096ee7ea48.png)


æ–¹å¼äºŒï¼šä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„EChartsæºç ï¼Œè™½ç„¶v5ç§»é™¤äº†å†…ç½®çš„GeoJSONï¼Œä½†æ˜¯åœ¨`test/data/map/json/`ä¸‹è¿˜è—äº†ä¸€ä»½ã€‚å’Œv4.xä¸åŒçš„æ˜¯ï¼Œå®ƒè¿˜å¤šäº†ä¸€ä¸ªå«`china-new.json`çš„GeoJSONï¼Œæˆ‘åœ¨é¡¹ç›®ä¸­ç”¨çš„å°±æ˜¯è¿™ä¸€ä»½GeoJSONï¼Œåé¢æˆ‘ä¼šè®²è§£å…¶ä¸­çš„åŒºåˆ«ã€‚

![img](./20230223-echarts-map.assets/1677058919064-45eab0e4-4d0f-42a9-9a1d-bef5c7012118.png)


æ–¹å¼ä¸‰ï¼šåœ¨[DataV.GeoAtlasåœ°ç†å°å·¥å…·](https://datav.aliyun.com/portal/school/atlas/area_selector)ä¸Šä¸‹è½½æœ€æ–°çš„GeoJSON

![img](./20230223-echarts-map.assets/1677059103147-142aca23-1204-4766-9ef6-74c3c10fe9c7.png)


ä½ ä¹Ÿå¯ä»¥å»GitHubä¸Šä¸‹è½½ï¼Œå¾ˆå¤šä»“åº“å¤‡ä»½äº†ä¸­å›½åœ°å›¾ç›¸å…³çš„GeoJSONï¼Œè¿™é‡Œè´´ä¸€ä¸ªå®˜æ–¹æ¨èçš„ç¬¬ä¸‰æ–¹èµ„æºï¼š[echarts-maps](https://github.com/echarts-maps)ã€‚

### 2.2 å¯¹æ¯”ä¸€ä¸‹ä¸­å›½åœ°å›¾GeoJSON

é€šè¿‡ä»¥ä¸Šä¸‰ç§æ–¹å¼ï¼Œå°±ä¸­å›½åœ°å›¾è€Œè¨€ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¾—åˆ°äº†å››ä»½ä¸­å›½åœ°å›¾çš„GeoJSONï¼Œä¸ºäº†æ–¹ä¾¿åŒºåˆ†ï¼Œæˆ‘é‡æ–°å‘½åä¸‹ï¼š

- `china.json`ï¼ˆby ECharts v4.xï¼‰ï¼Œå‘½åä¸ºï¼š`china-v4.json`
- `china.json`ï¼ˆby ECharts v5.xï¼‰ï¼Œå‘½åä¸ºï¼š`china-v5.json`
- `china-new.json`ï¼ˆby ECharts v5.xï¼‰ï¼Œå‘½åä¸ºï¼š`china-new-v5.json`
- `china.json`ï¼ˆby DataV.GeoAtlasï¼‰ï¼Œå‘½åä¸ºï¼š`china-datav.json`


å…¶ä¸­`china-v4.json`å’Œ`china-v5.json`æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚


ä»æ–‡ä»¶å¤§å°çœ‹ï¼Œ`china-v5.json`å’Œ`china-datav.json`æ˜¯æœ‰æ˜æ˜¾å·®å¼‚çš„ï¼Œå‰è€…åªæœ‰åè€…çš„ååˆ†ä¹‹ä¸€å¤§å°ï¼š

![img](./20230223-echarts-map.assets/1677122526555-85f396b8-4bfa-4d07-a8d1-90aa88600f15.png)

é€šè¿‡å¯¹æ¯”å…·ä½“å†…å®¹å‘ç°ï¼Œå¤§å°å·®å¼‚é™¤äº†å› ä¸º`china-datav.json`åœ¨`properties`ä¸­å¡äº†æ›´å¤šçš„æ‹“å±•å±æ€§å¤–ï¼Œæœ€å¤§çš„åŸå› æ˜¯`coordinates`çš„å·®å¼‚ã€‚


æ‹¿åŒ—äº¬å¸‚ä¸¾ä¾‹ï¼Œ`china-v5.json`ä¸­ï¼Œ`coordinates`çš„å€¼ï¼Œæ˜¯ä¸€å †ä¹±ç ä¸€æ ·çš„å­—ç¬¦ä¸²ï¼Œè€Œ`china-datav.json`çš„`coordinates`çš„å€¼è™½ç„¶æ˜¯æ­£ç»çš„åæ ‡æ•°å€¼ï¼Œä½†æ˜¯å…‰ä¸€ä¸ªåŒ—äº¬å¸‚çš„åæ ‡æ•°æ®ï¼Œæ ¼å¼åŒ–åå°±å äº†**979**è¡Œã€‚

![img](./20230223-echarts-map.assets/1677123361142-9b5ee261-c0bc-47de-bd12-63bb9ad66f72.png)

![img](./20230223-echarts-map.assets/1677123555289-d38cc445-07fc-491a-bdfd-7a77ec49fc38.png)


ä¸ºä»€ä¹ˆåŒä¸€åŒºåŸŸçš„åæ ‡æ•°æ®ï¼ŒäºŒè€…å¦‚æ­¤ä¸åŒï¼Ÿ


å¦‚æœç¿»é˜…EChartsæºç å°±å¯ä»¥å‘ç°ï¼Œè¿™æ˜¯å› ä¸ºEChartsåœ¨æ³¨å†Œåœ°å›¾è§£æGeoJSONï¼ˆ`parseGeoJSON`ï¼‰æ—¶ï¼Œå¦‚æœè¯†åˆ«åˆ°GeoJSONæ˜¯è¢«**å‹ç¼©**çš„ï¼ˆ`GeoJSON.UTF8Encoding === true`ï¼‰ï¼Œä¼šå…ˆè¡Œéå†è§£ç çš„æ“ä½œã€‚


è¿™ç§å‹ç¼©åçš„GeoJSONæ˜¯EChartsä¸“ç”¨çš„ï¼Œå¦‚æœå…¶ä»–å·¥å…·éœ€è¦ç”¨åˆ°ï¼Œéœ€è¦äº‹å…ˆè‡ªè¡Œè¿›è¡Œè§£ç æ“ä½œã€‚


æ ¸å¿ƒè§£ç ä»£ç å¦‚ä¸‹ï¼š

```js
// src/coord/geo/parseGeoJson.ts

function decodeRing(
    coordinate: string,
    encodeOffsets: number[],
    encodeScale: number
): number[][] {
    const result = [];
    let prevX = encodeOffsets[0];
    let prevY = encodeOffsets[1];

    for (let i = 0; i < coordinate.length; i += 2) {
        let x = coordinate.charCodeAt(i) - 64;
        let y = coordinate.charCodeAt(i + 1) - 64;
        // ZigZag decoding
        x = (x >> 1) ^ (-(x & 1));
        y = (y >> 1) ^ (-(y & 1));
        // Delta deocding
        x += prevX;
        y += prevY;

        prevX = x;
        prevY = y;
        // Dequantize
        result.push([x / encodeScale, y / encodeScale]);
    }

    return result;
}
```


æµ‹è¯•è§£å‹åŒ—äº¬å¸‚çš„åæ ‡æ•°æ®ï¼Œç»“æœå’ŒECharts GeoJSONçš„åæ ‡å¤§ä½“ç›¸åŒï¼Œåªæ˜¯å°æ•°ç‚¹ä¼šæœ‰ä¸€äº›å·®å¼‚ï¼š

![img](./20230223-echarts-map.assets/1677123859436-a558b5b1-4ebb-4e10-9f14-9c1a08b51336.png)


é™¤äº†EChartså’ŒDataV.GeoAtlasçš„GeoJSONæœ‰å·®å¼‚ï¼Œè¿˜å¯ä»¥çœ‹åˆ°v5çš„`china-new.json`è¦æ¯”v4å’Œv5çš„`china.json`å¤§äº†ä¸€ä¸¶ä¸¶ã€‚è¿™æ¶‰åŠåˆ°å—æµ·è¯¸å²›ç›¸å…³çš„æ˜¾ç¤ºå’Œé…ç½®çš„å·®å¼‚ï¼Œ[åé¢](https://www.yuque.com/wangxiaocuo/coding-blog/wagzirug6pv02bcv#scHIA)ä¼šä»”ç»†è®²è§£ã€‚


::: warning è­¦å‘Š
**å—æµ·è¯¸å²›å†æ¥éƒ½æ˜¯æˆ‘å›½é¢†åœŸçš„ç»„æˆéƒ¨åˆ†ï¼Œæ‰€ä»¥ä¸è¦æƒ³ç€å»éšè—å—æµ·è¯¸å²›ï¼ä¸­åäººæ°‘å…±å’Œå›½çš„ä¸»æƒå’Œé¢†åœŸå®Œæ•´ç¥åœ£ä¸å¯ä¾µçŠ¯ï¼ä½œä¸ºæŠ€æœ¯äººå‘˜ï¼Œä»»ä½•æƒ…å†µä¸‹å»ç»˜åˆ¶ä¸­å›½åœ°å›¾ï¼Œéƒ½ä¸èƒ½ç¼ºå¤±ä»»ä½•é¢†åœŸï¼**
:::


å¦å¤–ï¼ŒEChartsè¿˜æä¾›äº†çš„JSç‰ˆçš„GeoJSONï¼ˆv4.xåœ¨`map/js/`ä¸‹ï¼Œv5.xåœ¨`test/data/map/js/`ä¸‹ï¼‰ï¼Œå¤šäº†ä¸€ä¸ªè‡ªåŠ¨æ³¨å†Œçš„åŠŸèƒ½ï¼Œæ³¨å†Œåç§°ä¸æ–‡ä»¶åŒåã€‚æˆ‘ä¸å¤ªå–œæ¬¢ç”¨ï¼Œæƒ³è¦æŒ‰éœ€åŠ è½½ï¼Œå¾—æ‰‹åŠ¨åˆ›å»º`<script>`æ ‡ç­¾ï¼Œå¹¶ä¸”æ³¨å†Œåœ°å›¾çš„åç§°ä¸èƒ½ä¿®æ”¹ã€‚

## 03. `geo`å’Œ`series-map`çš„åŒºåˆ«

é€šè¿‡æŸ¥é˜…å®˜ç½‘æ–‡æ¡£ï¼Œä¼šå‘ç°ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ˜¾ç¤ºåœ°å›¾ï¼Œä¸€ç§æ˜¯é€šè¿‡[geo](https://echarts.apache.org/zh/option.html#geo.map)ï¼Œä¸€ç§æ˜¯é€šè¿‡[series-map](https://echarts.apache.org/zh/option.html#series-map.type)ã€‚


å®ƒä¿©æœ‰å•¥åŒºåˆ«ï¼Ÿæˆ‘ä»¬åº”è¯¥ç”¨å“ªä¸ªï¼Ÿ


- `geo`æ˜¯ä¸€ä¸ªåœ°ç†åæ ‡ç³»ç»„ä»¶ï¼Œå®ƒæ‰€ç»˜åˆ¶å‡ºæ¥çš„åœ°å›¾ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåœ°å›¾æ¨¡æ ·çš„åæ ‡ç³»ã€‚å®ƒæ²¡æœ‰`data`å±æ€§ï¼Œæ— æ³•ç›´æ¥ç»™åœ°å›¾ä¸Šæ¯ä¸ªåŒºåŸŸç»‘å®šé¢å¤–çš„æ•°æ®ã€‚æ—¢ç„¶å®ƒæ˜¯åæ ‡ç³»ï¼Œé‚£ä¹ˆåœ¨åæ ‡ç³»çš„åŸºç¡€ä¸Šï¼Œå¯ä»¥`series`å¡«å……å…¶ä»–å›¾å½¢ï¼Œæ¯”å¦‚åœ¨åœ°å›¾ä¸Šç»˜åˆ¶æ•£ç‚¹å›¾ã€‚
- `series-map`å’Œå…¶ä»–ç±»å‹ï¼ˆæŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾......ï¼‰çš„`series`ä¸€æ ·ï¼Œéƒ½æ˜¯æŒ‡å®šäº†ä¸€ä¸ª`type`ï¼Œç„¶åç”¨æ•°æ®å»é©±åŠ¨å±•ç¤ºå›¾å½¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šè‡ªå·±ç”Ÿæˆå†…éƒ¨ä¸“ç”¨çš„`geo`ç»„ä»¶ã€‚


å®ƒä»¬å¯ä»¥ä¸€èµ·ä½¿ç”¨ï¼Œä»¥è¾¾åˆ°æ›´åŠ å¤æ‚çš„æ•ˆæœã€‚`series-map`å¯ä»¥ä½¿ç”¨ç”¨`series-map.geoIndex`æŒ‡å®šä¸€ä¸ª`geo`ç»„ä»¶ã€‚è¿™æ ·çš„è¯ï¼Œ`series-map`å’Œå…¶ä»–`series`ï¼ˆä¾‹å¦‚æ•£ç‚¹å›¾ï¼‰å°±å¯ä»¥å…±äº«ä¸€ä¸ª`geo`ç»„ä»¶äº†ã€‚å¹¶ä¸”ï¼Œ`geo`ç»„ä»¶çš„é¢œè‰²ä¹Ÿå¯ä»¥è¢«è¿™ä¸ª`series-map`æ§åˆ¶ï¼Œä»è€Œç”¨`visualMap`æ¥æ›´æ”¹ã€‚


é€šä¿—ç‚¹è®²ï¼Œ`geo`æ˜¯ä¸€ä¸ªåæ ‡ç³»ï¼Œé€¼æ ¼æ›´é«˜ï¼Œå¯ä»¥ä½œç”¨äºæ‰€æœ‰`series`ã€‚è€Œ`series-map`åªæ˜¯`series`çš„ä¸€ç§ã€‚`series-map`åœ¨ä¸æŒ‡å®šå…¬ç”¨çš„`geo`ç»„ä»¶çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¼šè‡ªå·±ç”Ÿæˆä¸€ä¸ªè‡ªå·±ä¸“ç”¨çš„ã€‚


ä¸¤è€…ä¸€èµ·ç”¨çš„è¯ï¼Œ`series-map`åœ¨ä¸æŒ‡å®š`geo`ç»„ä»¶æ—¶ï¼Œä¼šå‡ºç°ä¸¤ä¸ªå åŠ çš„åœ°å›¾ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸¤ä¸ªåœ°å›¾ä¸åŒæ ·å¼å®ç°åœ°å›¾**å¤–è¾¹ç¼˜å‘å…‰**çš„æ•ˆæœã€‚è€Œæ™®é€šçš„éœ€æ±‚ï¼ˆæ¯”å¦‚åªéœ€è¦å±•ç¤ºåœ°å›¾çƒ­åŠ›å›¾ï¼‰ï¼Œåªç”¨`series-map`å°±å¤Ÿäº†ã€‚


åœ°å›¾å¤–è¾¹ç¼˜å‘å…‰æ•ˆæœç¤ºä¾‹ï¼š
```js
const option = {
  backgroundColor: 'transparent',
  geo: {
    map: 'china', // ä½¿ç”¨ä¸­å›½åœ°å›¾
    roam: false, // ä¸å…è®¸ç¼©æ”¾å’Œæ‹–åŠ¨
    itemStyle: {
      borderColor: '#a18a3a', // è¾¹æ¡†é¢œè‰²
      borderWidth: 0.5, // è¾¹æ¡†å®½åº¦
      shadowColor: '#a18a3a', // é˜´å½±é¢œè‰²
      shadowBlur: 100 // é˜´å½±å¤§å°
    },
    emphasis: {
      itemStyle: {
        areaColor: '#2a333d' // é«˜äº®åŒºåŸŸé¢œè‰²
      },
      label: {
        show: false
      }
    }
  },
  series: [
    {
      type: 'map',
      map: 'china',
      zlevel: 1,
      nameProperty: 'id',
      nameMap,
      roam: false,
      select: {
        disabled: true
      },
      itemStyle: {
        areaColor: '#2F4858',
        borderColor: '#a18a3a',
        borderWidth: 1
      },
      emphasis: {
        itemStyle: {
          show: false,
          areaColor: null
        },
        label: {
          show: false
        }
      },
      data: [
        {
          name: 'å—æµ·è¯¸å²›',
          value: 0,
          label: { show: false },
          itemStyle: {
            opacity: 0
          },
          tooltip: {
            extraCssText: 'opacity: 0;'
          }
        }
      ]
    }
  ]
}
```

## 04. å…³äºå—æµ·è¯¸å²›

å½“æ³¨å†Œçš„åœ°å›¾åç§°ä¸º`china`æ—¶ï¼Œåœ¨`src/coord/geo/fix/nanhai.ts`ä¸­ä¸“é—¨é’ˆå¯¹å—æµ·åšäº†ç‰¹æ®Šå¤„ç†ï¼Œä¼šè‡ªåŠ¨åœ¨å³ä¸‹è§’è¿½åŠ ä¸€ä¸ªç®€ç•¥çš„å—æµ·ç¼©ç•¥å›¾ã€‚

![img](./20230223-echarts-map.assets/1677151395947-c47a9c88-0a8e-460b-9652-916d48f15bbb.png)


ä¸‹é¢æœ‰ä¸€ä»½ç®€å•çš„ç¤ºä¾‹ä»£ç ï¼š

![img](./20230223-echarts-map.assets/1677146097322-658999dd-f016-4f54-af58-1ef5eb05b7a8.png)


åœ¨å…¶ä»–æ¡ä»¶ä¸å˜æ—¶ï¼Œé€šè¿‡ä¿®æ”¹`url`ï¼Œæ¥åˆ‡æ¢ä¸åŒçš„GeoJSONæ•°æ®æºï¼Œçœ‹çœ‹æ˜¾ç¤ºçš„æ•ˆæœï¼š

- `china-v5.json`

![img](./20230223-echarts-map.assets/1677146142421-1d40e09c-88a7-42fb-8a3b-04bbcf068c1c.png)

- `china-new-v5.json`

![img](./20230223-echarts-map.assets/1677146230178-263f0751-5928-4ecf-8e68-e5b7dd9578e5.png)

- `china-datav.json`

![img](./20230223-echarts-map.assets/1677146282937-db954cac-adbd-4745-8575-f03a40960de0.png)


å—¯ï¼Ÿæˆ‘ä»¬ä¸­å¥½åƒå‡ºç°äº†å›å¾’ï¼Œè¯´å¥½çš„ç®€ç•¥çš„å—æµ·ç¼©ç•¥å›¾å‘¢ï¼Œæ€ä¹ˆ`china-new-v5.json`ä½ çš„ç¼©ç•¥å›¾è¿™ä¹ˆåˆ«è‡´ï¼Ÿä¸å…‰æœ‰åç§°ï¼Œè¿˜å¸¦æœ‰å²›å±¿ï¼Ÿ


è¿™æ˜¯å› ä¸ºï¼Œ`china-new-v5.json`ç›´æ¥åœ¨GeoJSONä¸­æ·»åŠ äº†å—æµ·è¯¸å²›ç¼©ç•¥å›¾ï¼š

![img](./20230223-echarts-map.assets/1677151875968-6fa68057-2535-415d-89c7-1b7da88c698f.png)


å†å›è¿‡å¤´æ¥çœ‹çœ‹ä¸Šé¢ä¸Šé¢ä¸‰ç§GeoJSONçš„å›¾ï¼Œå®ƒä»¬å„æœ‰å„çš„ç‰¹ç‚¹ï¼š

- `china-v5.json`ï¼šé™†åœ°åœ°å›¾åœ¨ç”»å¸ƒä¸­å æ¯”å¤§çœ‹ç€èˆ’æœï¼Œå—æµ·é¢†æµ·ç¼©ç•¥å›¾å¾ˆç®€é™‹ï¼Œçœ‹ä¸åˆ°å—æµ·å²›å±¿
- `china-new-v5.json`ï¼šé™†åœ°åœ°å›¾åœ¨ç”»å¸ƒä¸­å æ¯”å¤§çœ‹ç€èˆ’æœï¼Œå—æµ·é¢†æµ·ç¼©ç•¥å›¾å¤Ÿè¯¦ç»†ï¼Œèƒ½çœ‹é“å—æµ·å²›å±¿
- `china-datav.json`ï¼šé™†åœ°åœ°å›¾åªå äº†ä¸€åŠå¤šç‚¹ï¼Œæœ‰å¤§é¢ç§¯ç•™ç™½ï¼Œçœ‹ç€ä¸å¤ªèˆ’æœ


è¿™ä¹ˆä¸€å¯¹æ¯”ï¼Œ`china-new-v5.json`æ˜æ˜¾æ›´å ä¼˜åŠ¿ï¼Œæ˜¾ç¤ºçš„æ•ˆæœæ›´å¥½ï¼Œä¸”è‡ªå¸¦å—æµ·è¯¸å²›ç¼©ç•¥å›¾ï¼Œä¸éœ€è¦éå¾—è®¾ç½®æ³¨å†Œåç§°æ˜¯`china`ã€‚


å¦‚æœæˆ‘ä»¬å»æŸ¥çœ‹ç™¾åº¦çš„äº§å“å¯¹äºEChartsçš„è¿ç”¨ï¼Œæ¯”å¦‚[ç™¾åº¦æŒ‡æ•°](https://index.baidu.com/v2/index.html)ï¼Œå°±å¯ä»¥å‘ç°ï¼Œå®˜æ–¹å®æˆ˜ç”¨çš„åº”è¯¥ä¹Ÿæ˜¯`china-new-v5.json`ã€‚ï¼ˆå“¦ï¼Œåº”è¯¥å«å‰å®˜æ–¹ğŸ‘»ï¼Œå®˜ç½‘çš„[åœ°å›¾demo](https://echarts.apache.org/examples/zh/editor.html?c=map-usa)éƒ½å·²ç»æ˜¯ç¾å›½çš„å½¢çŠ¶äº†ï¼‰

![img](./20230223-echarts-map.assets/1677152538541-9e40d999-96e7-4f9f-a573-aa9360b46c06.png)

## 05. åœ°å›¾çƒ­åŠ›å›¾

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä»½åœ°å›¾åŒºåŸŸæ•°æ®ï¼Œé‚£ä¹ˆç»“åˆ`visualMap`ï¼Œå°±å¯ä»¥å®ç°çƒ­åŠ›å›¾çš„æ•ˆæœï¼š

```js
const data = [
  {
    name: 'ä¸Šæµ·',
    value: 9000
  },
  {
    name: 'æ±Ÿè‹',
    value: 8000
  },
  {
    name: 'é’æµ·',
    value: 600
  }
]
async function init() {
  const url = './geo-jsons/china-new-v5.json'
  const res = await fetch(url)
  chinaGeoJson = await res.json()

  echarts.registerMap('china', chinaGeoJson)
  const myChart = echarts.init(document.getElementById('chart'))

  myChart.setOption({
    tooltip: {
      trigger: 'item'
    },
    visualMap: {
      type: 'piecewise',
      max: 10000,
      min: 0,
      text: ['é«˜', 'ä½'],
      calculable: true
    },
    series: [
      {
        name: 'æµ‹è¯•æŒ‡æ ‡',
        type: 'map',
        map: 'china',
        data
      }
    ]
  })
}

init()
```

![img](./20230223-echarts-map.assets/1677153498428-af322b7b-b27c-419a-9d8a-80be78b8b7f9.png)


ä»ä»£ç ä¸­å¯ä»¥å‘ç°ï¼Œ`data`ä¸­çš„æ•°æ®ï¼Œåªæœ‰`name`å’Œ`value`ï¼Œæ²¡ä»€ä¹ˆç‰¹æ®Šçš„ã€‚å®ƒä¹‹æ‰€ä»¥ä¼šè¢«è‡ªåŠ¨ç»‘å®šåˆ°å¯¹åº”çš„åŒºåŸŸä¸­ï¼Œæ˜¯å› ä¸º`series-map.nameProperty`é»˜è®¤ä¸º`name`ï¼Œå®ƒä¼šæŠŠ`name`ä½œä¸ºä¸»é”®ç”¨äºå…³è”æ•°æ®ç‚¹å’ŒGeoJSONåœ°ç†è¦ç´ ã€‚å³`data`ä¸­çš„`name`çš„å€¼åªè¦ä¸GeoJSONä¸­`properties`ä¸­çš„`name`çš„å€¼ä¸€ä¸€å¯¹åº”ä¸Šï¼Œå°±èƒ½æ­£å¸¸æ˜¾ç¤ºå‡ºçƒ­åŠ›å›¾ã€‚


ä½†è¦æ˜¯å¯¹ä¸ä¸Šäº†ï¼Ÿ`china-new-v5.json`ä¸­é»˜è®¤æ˜¯`ä¸Šæµ·`ã€`æ±Ÿè‹`ã€`æ–°ç–†`ï¼Œä½†å¦‚æœåç«¯è¿”å›ç»™å‰ç«¯çš„æ•°æ®æ˜¯`ä¸Šæµ·å¸‚`ã€`æ±Ÿè‹çœ`ã€`æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº`å‘¢ï¼Ÿ


æ˜¾ç„¶ï¼Œæœ‰æ—¶å€™ç”¨`name`å»ä½œä¸ºæ•°æ®ä¸GeoJSONæ˜ å°„çš„ä¸»é”®ï¼Œä¼šå‡ºç°é—®é¢˜ã€‚


å½“ç„¶å¦‚æœå‰åç«¯çº¦æŸå¥½äº†ï¼Œå¹¶ä¸”æ•°æ®æ¥æºæ˜ç¡®ï¼Œä¸ä¼šå‡ºç°ä¹±ç³Ÿç³Ÿçš„æ•°æ®ï¼Œç›´æ¥ç”¨`name`å½“ç„¶æ²¡é—®é¢˜ã€‚


å¯ä»¥é€šè¿‡ä¿®æ”¹`series-map.nameProperty`æ¥ä¿®æ”¹é»˜è®¤çš„å…³è”ä¸»é”®ã€‚ä½†è®¾ç½®ä»€ä¹ˆå­—æ®µæ¯”è¾ƒåˆé€‚å‘¢ï¼Ÿæˆ‘ä»¬å›è¿‡å¤´æ¥è§‚å¯Ÿä¸‹ä¸¤ä¸ªæ¥æºçš„GeoJSONï¼Œä¼šå‘ç°æœ‰ä¸€ä¸ªä¸œè¥¿æ˜¯å”¯ä¸€çš„ï¼Œé‚£å°±æ˜¯è¡Œæ”¿åŒºåˆ’ä»£ç ï¼ŒEChartsçš„å«`id`ï¼ŒDataV.GeoAtlasçš„å«`adcode`ã€‚


![img](./20230223-echarts-map.assets/1677293235869-7f3a6110-e026-42e5-8790-993b6b8c1977.png)


ä¸€èˆ¬å…¬å¸éƒ½ä¼šçˆ¬ä¸€ä»½è¡Œæ”¿åŒºåˆ’ä»£ç ï¼Œä½œä¸ºåŸºç¡€æ•°æ®ä½¿ç”¨ã€‚


ç›®å‰æœ€æ–°çš„åŸä¹¡åŒºåˆ’ä»£ç å¯ä»¥å‚è€ƒï¼š[å›½å®¶ç»Ÿè®¡å±€>>ç»Ÿè®¡ç”¨åŒºåˆ’å’ŒåŸä¹¡åˆ’åˆ†ä»£ç ](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/)ã€‚è¿™æ˜¯æœ€æ–°çš„æ ‡å‡†ï¼Œå®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸€èˆ¬åªéœ€è¦å–å‰6ä½ä½¿ç”¨ã€‚

![img](./20230223-echarts-map.assets/1677295252303-cf47e352-9544-4356-bf19-48b2cf53b8fc.png)

![img](./20230223-echarts-map.assets/1677295535846-8ef1ebf1-df62-4035-92ab-80d8d870c2c9.png)


å…¶ä¸­çœä»½åŒºåˆ’ä»£ç æ²¡æœ‰æ˜ç¡®æ ‡æ³¨ï¼Œå¯ä»¥é€šè¿‡æˆªå–å¸‚çš„åŒºåˆ’ä»£ç çš„å‰ä¸¤ä½ï¼Œåé¢æ‹¼ä¸Š6ä¸ª0ï¼Œä¹Ÿå¯ä»¥ç›´æ¥[ç™¾åº¦ç™¾ç§‘](https://baike.baidu.com/item/è¡Œæ”¿åŒºåˆ’ä»£ç /5650987)æŸ¥çœ‹ï¼Œçœä»½çš„åŒºåˆ’ä»£ç å¾ˆå¤šå¹´æ²¡å˜äº†ã€‚

å…¶ä¸­ä¹Ÿä¸åŒ…å«æˆ‘å›½å°æ¹¾çœã€é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒºå’Œæ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒºã€‚å°æ¹¾çœï¼š`710000`ï¼Œé¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒºï¼š`810000`ï¼Œæ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒºï¼š`820000`ã€‚


å¦‚æœä½ çš„åœ°å›¾æœ‰ä¸‹é’»åŠŸèƒ½ï¼Œé‚£ä¹ˆGeoJSONä¸­çš„åŸä¹¡åŒºåˆ’ä»£ç å¯èƒ½æ˜¯æ—§çš„ï¼Œéœ€è¦æ ¹æ®å®é™…åç«¯è¿”å›çš„æ•°æ®åšæ›´æ–°ã€‚


å¦å¤–ï¼Œåœ¨æ˜¾ç¤ºçƒ­åŠ›å›¾æ—¶ï¼Œ`china-new-v5.json`çš„å—æµ·è¯¸å²›ç”±äºå±äºGeoJSONçš„ä¸€ä¸ªåŒºåŸŸï¼Œæ‰€ä»¥ä¹Ÿä¼šæ˜¾ç¤º`tooltip`ï¼š

![img](./20230223-echarts-map.assets/1677294563282-472ef123-591e-44b1-94f6-727541342d85.png)

å¯ä»¥é€šè¿‡ä»¥ä¸‹è®¾ç½®éšè—æ‰ï¼š

```js
data.unshift({
  name: 'å—æµ·è¯¸å²›',
  value: 0,
  itemStyle: {
    opacity: 0,
    label: { show: false }
  },
  tooltip: {
    extraCssText: 'opacity: 0;'
  }
})
```


------

ä»¥ä¸Šï¼Œå¸Œæœ›å¯¹ä½ æœ‰ç”¨ã€‚
